

容器实现封闭的环境主要要靠两种技术，一种是看起来是隔离的技术，称为 namespace（命名空间）。在每个 namespace 中的应用看到的，都是不同的 IP 地址、用户空间、进程 ID 等。另一种是用起来是隔离的技术，称为 cgroup（网络资源限制），即明明整台机器有很多的 CPU、内存，但是一个应用只能用其中的一部分。  


<img src="https://github.com/Yongli-Lisa/Linux-Notes1/blob/f0aa463c555efc1e44009e847078248012fb9a66/Img/%E5%AE%B9%E5%99%A8/%E5%AE%B9%E5%99%A8.PNG" width="500px">  

<img src="https://github.com/Yongli-Lisa/Linux-Notes1/blob/a6b251166985a8096bed82a6da926aba756ba6c9/Img/%E5%AE%B9%E5%99%A8/NS.PNG" width="800px">  

  
Namespace:  
UTS，对应的宏为 CLONE_NEWUTS，表示不同的 namespace 可以配置不同的 hostname。  
User，对应的宏为 CLONE_NEWUSER，表示不同的 namespace 可以配置不同的用户和组。  
Mount，对应的宏为 CLONE_NEWNS，表示不同的 namespace 的文件系统挂载点是隔离的。  
PID，对应的宏为 CLONE_NEWPID，表示不同的 namespace 有完全独立的 pid，也即一个 namespace 的进程和另一个 namespace 的进程，pid 可以是一样的，但是代表不同的进程。  
Network，对应的宏为 CLONE_NEWNET，表示不同的 namespace 有独立的网络协议栈。  


docker inspect 查看容器对应的entrypoint的进程号  
ls -l /proc/pid/ns 查看容器的NS  
nsenter 用来运行一个进程，进入指定的NS  (# nsenter --target 58212 --mount --uts --ipc --net --pid -- env --ignore-environment -- /bin/bash)  
unshare 用来离开当前的NS,创建且加入新的NS，然后执行参数中指定的命令  （unshare --mount --ipc --pid --net --mount-proc=/proc --fork /bin/bash）  


NS总结：  
<img src="https://github.com/Yongli-Lisa/Linux-Notes1/blob/a6b251166985a8096bed82a6da926aba756ba6c9/Img/%E5%AE%B9%E5%99%A8/NS%E6%80%BB%E7%BB%93.PNG" width="900px">
